{include file="public/header" /}
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/webuploader.css">
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/style.css">
<link rel="stylesheet" href="/static/admin/css/zTreeStyle/zTreeStyle.css">
<link rel="stylesheet" href="/static/admin/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/static/admin/css/jedate.css">
<link rel="stylesheet" href="/static/admin/css/iconfont.css">
<style>
    #picker{
        position: absolute;
        right: 166px;
        width: 69px;
        height: 34px;
        text-align: center;
        color: #fff;
        cursor: pointer;
        background-color: #00a2d4;
    }
    #path,#aPairOfPath{
        line-height: 30px;
        font-weight: 700;
        border-bottom: 1px solid #000;
    }
    #admin_table_wrapper .mybtn{
        position: absolute;
        left: 30px;
        top: -93px;
    }
    #imgPicker>div:nth-child(2){
        width: 100% !important;
        height: 100% !important;
    }
    #mytable1_wrapper th,#mytable1_wrapper td{
        text-align: center;
    }
    .webuploader-pick{
        left: 0;
        top: 0;
        width: 100px;
        height: 100%;
    }
    #btn_upload{
        display: none;
    }
    #file_upload>div:nth-child(2){
        position: absolute;
        left: 0 !important;
        top: 0 !important;
        width: 100%;
        height: 100%;
    }

    #file_upload1>div:nth-child(2){
        width: 100% !important;
        height: 100% !important;
        position: absolute;
        left: 0 !important;
        top: -15px !important;
    }
    #mytable1_wrapper{
        display: block;
    }
    #mytable1_wrapper #additionTerm{
        margin-top: 45px;
        border-top: 1px solid lightseagreen;
        padding-top: 8px;
        padding-bottom: 12px;
    }
    .panrpos{
        position: relative;
    }
    .pos{
        width: 223px;
        height: 106px;
        position: absolute;
        left: 0px;
        top: 34px
    }
    #excel{
        width: 390px;
        height: 33px;
        position: absolute;
        right: 6px;
        top: 50px;
        z-index: 4;
    }
    #excel button{
        margin-left: 15px;
    }
    #excelImport{
        outline: none;
        border: none;
        margin-right: -10px;
        margin-top: -15px;
        height: 27px;
    }
    #excel select{
        margin-left: 10px;
        width: 152px;
    }
    #admin_table_wrapper .float_left{
        position: absolute;
        left: 260px;
        top: -89px;
    }
    #mytable1_wrapper .myl{
        position: absolute;
        top: -86px;
        left: 104px;
    }
    .selectyear{
        position: absolute;
        left: 216px;
        top: 4px;
    }
    #excelImport div:nth-of-type(1){
        width: 60px;
        height: 30px;
        line-height: 6px;
        color: #1c84c6;
        border:1px solid #1c84c6;
        display: block;
        outline: none;
        background: #FFFFFF;
    }
    #edParent {
        width: 100px;
    }
    .pickerCon{
        color: black;
        position: absolute;
        top: 14px;
        left: 130px;
    }
    .dataTable thead  tr td:first-child:after{
        content: ""!important;
        display: none!important;
    }
    .myLine{
        margin-right: 30px;
    }
    #sel1,#sel2,#sel3,#sel4,#sel5{
        width: 130px;
        margin-left: 5px;
    }

    #aPairOf,.rePath{
        display: inline-block;
        background: #009F95;
        width: 90px;
        height: 32px;
        line-height: 32px;
        border-radius: 3px;
        color: white;
        cursor: pointer;
    }
    #aPairOf_wrapper .rePath{
        text-align: center;
        margin-right: 240px;
        margin-bottom: 10px;
        margin-top: 5px;
    }
    #risk_table_model thead input{
        border: 1px solid;
        outline: none;
        width: 100%;
    }
    #risk_table_model thead select{
        width: 120px;
    }
    #risk_table_model thead td{
        border: 1px solid black;
    }
    #risk_table_model thead textarea{
        width: 100%;
        height: 150px;
    }
    #risk_table_model thead .photo{
        width: 100%;
        height: 230px;
    }
    #risk_table_model thead .colorSee{
        background-color:#b9e1f2;
    }
    .rePath{
        z-index: 4;
    }
    .thumbnail{
        display: inline-block;
        margin-left: 5px;
    }
    .thumbnail>img{
        display: inline-block;
        margin-left: 5px;
    }
    #aPairOf_reduce_table_model input[type="number"],#aPairOf_reduce_table_model input[type="text"]{
        width:100%;
    }
    .table_td{
        width:15%;
    }
    #aPairOfPathSpan,#spanPath{
        display: inline-block;
        float: left;
    }
</style>
<body>
<!--表格-->
<div class="wrapper wrapper-content animated fadeInRight" style="width: 98%;vertical-align: top;padding: 0;margin-top: 20px;margin-left: 20px;text-align: center">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <div class="row">
                <div id="path"><span id="spanPath">隐患排查治理</span><div style="clear: both;"></div></div>
                <div id="mytable1_wrapper">
                    <div id="excel">
                        <div class='btn' id="excelImport"></div>
                        <button class='btn btn-success btn-outline btn-sm' id="excelExport">导出</button>
                        <button class='btn btn-success btn-outline btn-sm' id="moldPlate">导出excel模板</button>
                    </div>
                    <!--加分项-->
                    <div id="additionTerm">
                        <from  class="form-inline">
                            <div class="form-group myLine">
                                <label for="sel1">责任标段</label>
                                <select class="form-control" id="sel1">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                            <div class="form-group myLine">
                                <label for="sel1">隐患类型</label>
                                <select class="form-control" id="sel2">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                            <div class="form-group myLine">
                                <label for="sel1">隐患来源</label>
                                <select class="form-control" id="sel3">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                            <div class="form-group myLine">
                                <label for="sel1">发现人</label>
                                <select class="form-control" id="sel4">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                            <div class="form-group myLine">
                                <label for="sel1">隐患等级</label>
                                <select class="form-control" id="sel5">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                            <div class="form-group myLine"><span id="aPairOf"></span></div>
                        </from>
                    </div>
                    <table id="admin_table" width="100%" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <td rowspan="2"><input type="checkbox" class="checkall">全选</td>
                                <td rowspan="2">ID</td>
                                <td colspan='7'>排查</td>
                                <td>评估</td>
                                <td colspan='3'>治理</td>
                                <td colspan='2'>验收</td>
                                <td rowspan="2">操作</td>
                            </tr>
                            <tr>
                                <td>隐患内容</td>
                                <td>隐患部位</td>
                                <td>责任标段</td>
                                <td>隐患类别</td>
                                <td>隐患来源 </td>
                                <td>发现日期</td>
                                <td>发现人</td>
                                <td>隐患等级</td>
                                <td>治理措施</td>
                                <td>治理时限</td>
                                <td>施工单位治理责任人</td>
                                <td>治理完成时间</td>
                                <td>验收人</td>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--下载的文件-->
<div id="formDown" style="display: none"></div>
<!--表格的新增与编辑-->
<div id="risk_modal" data-keyboard="false" data-backdrop="static" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="risk_modal" aria-hidden="true" style="width: 60%;margin: 0 auto;margin-top: 40px;">
    <div class="row">
        <div class="col-sm-12" style="background-color:#fff;">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                </div>
                <input type="text" name="uid" id="id1" style="display: none;" value="">
                <div class="ibox-content">
                    <!--新增用户信息开始-->
                    <form class="form-horizontal" name="memberAdd" id="memberAdd" method="post"  action="#" onsubmit="return false">
                        <input type="text" name="id" id="riskId" style="display: none;">
                        <input type="text" name="group_id" id="rgroup_id" style="display: none;">
                        <table id="risk_table_model" width="100%" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <td rowspan="5" class="colorSee">排查</td>
                                    <td colspan="6" class="colorSee">隐患内容</td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <textarea name="riskText" id="riskText" required="required" placeholder="此处为必填项"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="colorSee">隐患部位</td>
                                    <td class="colorSee">责任标段</td>
                                    <td class="colorSee">隐患类别</td>
                                    <td class="colorSee">隐患来源</td>
                                    <td class="colorSee">发现日期</td>
                                    <td class="colorSee">发现人</td>
                                </tr>
                                <tr>
                                    <td>
                                        <input type="text" id="hiddenPart" name="隐患部位" required="required" placeholder="此处为必填项">
                                    </td>
                                    <td>
                                        <select name="liabilitySection" id="liabilitySection">
                                            <option value="">c1标</option>
                                            <option value="">c2标</option>
                                            <option value="">eM1标</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="hiddenCategory" id="hiddenCategory">
                                            <option value="">脚手架</option>
                                            <option value="">c2标</option>
                                            <option value="">eM1标</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="sourceDanger" id="sourceDanger">
                                            <option value="">专项检查</option>
                                            <option value="">c2标</option>
                                            <option value="">eM1标</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" id="dateDiscovery" name="发现日期" required="required" placeholder="此处为必填项">
                                    </td>
                                    <td>
                                        <input type="text" id="discovery" name="发现人" required="required" placeholder="此处为必填项">
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="6" style="text-align: left !important">
                                        <!--隐患照片-->
                                        <div class="photo">
                                            <div id="thelist" class="uploader-list"></div>
                                            <div>
                                                <div id="filePicker" style="display: inline-block;">选择图片</div>
                                                <!--<button id="ctlBtn" class="btn btn-default"  style="display: inline-block;">开始上传</button>-->
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="2" class="colorSee">评估</td>
                                    <td colspan="6" class="colorSee">隐患等级</td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <select name="hiddenGrade" id="hiddenGrade">
                                            <option value="">c1标</option>
                                            <option value="">c2标</option>
                                            <option value="">eM1标</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="4" class="colorSee">治理</td>
                                    <td colspan="6" class="colorSee">治理措施</td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <textarea name="goveMeasures" id="goveMeasures" required="required" placeholder="此处为必填项"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="colorSee">治理时限</td>
                                    <td colspan="3" class="colorSee">施工单位责任人</td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <input type="text" id="timeLimit" required="required" placeholder="此处为必填项">
                                    </td>
                                    <td colspan="3">
                                        <input type="text" id="personLiable" required="required" placeholder="此处为必填项">
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="3" class="colorSee">验收</td>
                                    <td colspan="3" class="colorSee">治理完成时间</td>
                                    <td colspan="3" class="colorSee">验收人</td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <input type="text" id="completionTime" name="治理完成时间" required="required" placeholder="此处为必填项">
                                    </td>
                                    <td colspan="3">
                                        <input type="text" id="acceptor" name="验收人" required="required" placeholder="此处为必填项">
                                    </td>
                                </tr>
                                <tr>
                                    <!--整改后照片-->
                                    <td colspan="6" class="photo" style="text-align: left !important">
                                        <div class="photo">
                                            <div id="thelistAfter" class="uploader-list"></div>
                                            <div>
                                                <div id="filePickerAfter" style="display: inline-block;">选择图片</div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </thead>
                        </table>
                        <div class="form-group">
                            <div class="col-xs-12" style="text-align: center;">
                                <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                            </div>
                        </div>
                    </form>
                    <!--新增用户信息结束-->

                </div>
            </div>
        </div>
    </div>
</div>

<!--一岗双责-->
<div class="aPairOf_risk animated fadeInRight" style="display:none;width: 98%;vertical-align: top;padding: 0;margin-top: 20px;margin-left: 20px;text-align: center">
    <div class="ibox">
        <div class="ibox-content">
            <div class="row">
                <div id="aPairOfPath"><span id="aPairOfPathSpan">隐患排查治理 一岗双责</span><div style="clear: both;"></div></div>
                <div id="aPairOf_wrapper">
                    <div class="rePath">返回</div>
                    <table id="aPairOf_table" width="100%" class="table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th>姓名</th>
                            <th>部门</th>
                            <th>总得分</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--一岗双责查看-->
<div id="aPairOf_modal" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="level2" aria-hidden="true" data-keyboard="false" data-backdrop="static" style="width: 60%;margin: 0 auto;margin-top: 40px;">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5></h5>
                </div>
                <div class="ibox-content">
                    <!--新增用户信息开始-->
                    <form class="form-horizontal" name="level2Add" id="level2Add" method="post" action="#" onsubmit="return false">
                        <input type="text" name="aPairOfId" value="" id="aPairOfId" style="display: none;">
                        <input type="text" name="aFormId" value="" id="aFormId" style="display: none;">
                        <table id="aPairOf_table_model" width="100%" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <td class="colorSee">姓名</td>
                                    <td class="colorSee">隐患类别</td>
                                    <td class="colorSee">排查</td>
                                    <td class="colorSee">验收</td>
                                    <td class="colorSee">总得分</td>
                                </tr>
                                <tr>
                                    <td rowspan="15" class="colorSee"></td>
                                    <td class="colorSee">脚手架</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                    <td rowspan="15" class="colorSee"></td>
                                </tr>
                                <tr>
                                    <td class="colorSee">安全文明施工</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>

                                <tr>
                                    <td class="colorSee">环水保</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">施工用电</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">反违章</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">施工机具</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">交通安全</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">警示标示</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">地质灾害</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">爆破作业</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">消防安全</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">职业健康</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">起重作业</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">特种设备</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                                <tr>
                                    <td class="colorSee">重大事故隐患</td>
                                    <td class="colorSee">0.5</td>
                                    <td class="colorSee">0.5</td>
                                </tr>
                            </thead>
                        </table>
                        <div class="form-group">
                            <div class="col-xs-12" style="text-align: center;">
                                <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                            </div>
                        </div>
                    </form>
                    <!--新增用户信息结束-->
                </div>
            </div>
        </div>
    </div>
</div>
<!--一岗双责减分设置-->
<div id="aPairOf_reduce_modal" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="level2" aria-hidden="true" data-keyboard="false" data-backdrop="static" style="width: 80%;margin: 0 auto;margin-top: 40px;">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5></h5>
                </div>
                <div class="ibox-content">
                    <!--新增用户信息开始-->
                    <form class="form-horizontal" name="aPairOf_reduce" id="aPairOf_reduce" method="post" action="#" onsubmit="return false">
                        <input type="text" name="aPairOfId" value="" id="aPairOf_reduceId" style="display: none;">
                        <input type="text" name="aFormId" value="" id="reduceId" style="display: none;">
                        <table id="aPairOf_reduce_table_model" width="100%" class="table table-striped table-bordered">
                            <thead>
                            <tr>
                                <td class="colorSee">姓名</td>
                                <td class="colorSee">部门</td>
                                <td class="colorSee">扣分类别</td>
                                <td class="colorSee">分数</td>
                                <td class="colorSee">时间</td>
                                <td class="colorSee">内容</td>
                                <td class="colorSee">备注</td>
                            </tr>
                            <tr>
                                <td rowspan="7" class="colorSee"></td>
                                <td rowspan="7" class="colorSee"></td>
                                <td class="colorSee">现场隐患未发现</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee1">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce1" id="reduce1">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark1" id="reduceRemark1"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">隐患未整改闭环</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee2">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce2" id="reduce2">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark2" id="reduceRemark2"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">安全记录不规范</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee3">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce3" id="reduce3">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark3" id="reduceRemark3"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">未落实风险管控责任</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee4">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce4" id="reduce4">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark4" id="reduceRemark4"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">安全措施验收不负责</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee5">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce5" id="reduce5">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark5" id="reduceRemark5"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">现场未执行方案</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee6">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce6" id="reduce6">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark6" id="reduceRemark6"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="colorSee">无方案施工且未制止</td>
                                <td class="colorSee table_td">
                                    <input type="number" id="numSee7">
                                </td>
                                <td class="table_td">
                                    <input type="text" name="reduce7" id="reduce7">
                                </td>
                                <td class="table_td">
                                    <input type="text" value="内容">
                                </td>
                                <td class="table_td">
                                    <textarea name="reduceRemark7" id="reduceRemark7"></textarea>
                                </td>
                            </tr>

                            </thead>
                        </table>
                        <div class="form-group">
                            <div class="col-xs-12" style="text-align: center;">
                                <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                            </div>
                        </div>
                    </form>
                    <!--新增用户信息结束-->
                </div>
            </div>
        </div>
    </div>
</div>

{include file="public/footer" /}
<script type="text/javascript" src="/static/admin/webupload/webuploader.min.js"></script>

<script src="__JS__/jquery.ztree.all.js"></script>
<script src="__JS__/jquery.dataTables.min.js"></script>
<script src="__JS__/jquery.jedate.js"></script>

</body>
</html>


<script type="text/javascript">

    //点击时间插件
    //发现人时间
    $("#dateDiscovery").jeDate({
        format: "YYYY-MM-DD"
    });
    //治理时间
    $("#timeLimit").jeDate({
        format: "YYYY-MM-DD"
    });
    //治理完成时间
    $("#completionTime").jeDate({
        format: "YYYY-MM-DD"
    });

    var admin_table = $('#admin_table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "__SCRIPT__/safety_risk.php"
        },
        "dom": '<"mybtn btn btn-outline btn-primary"><"selectyear"><"myl"l><"float_left"f>tip',
        "columnDefs": [
            {
                "searchable": false,
                "targets": 0,
                "render": function (data, type, full, meta) {
                    return '<input type="checkbox"  class="checkchild" onclick="getRadioId(this)" value="' + data + '" />';
                }
            },
            {
                "searchable": false,
                "orderable": false,
                "targets": [15],
                "render" :  function(data,type,row) {
                    var html = "<input type='button' class='btn btn-success btn-outline btn-xs' style='margin-left: 5px;' onclick='preview(this)' value='查看'/>" ;
                    html += "<input type='button' class='btn btn-primary btn-outline btn-xs' style='margin-left: 5px;' onclick='riskEdit(this)' value='编辑'/>" ;
                    html += "<input type='button' class='btn btn-danger btn-outline btn-xs' style='margin-left: 5px;' onclick='del(this)' value='删除'/>" ;
                    return html;
                }
            }
        ],
        "language": {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    } );
    $("#admin_table thead td:first-child").unbind();
    $("div.mybtn").html('<div id="xz">新增</div>');
    //点击新增按钮
    $(".mybtn").click(function () {
        $("#risk_modal input").val("");
        $("#file_list1").empty();
        $("#riskText").empty();
        $("#risk_modal h5").text("新增");
        $("#risk_modal").modal('show');
        console.log($("#riskId").val())
        console.log($("#liabilitySection option:selected").text())//标段
        console.log($("#hiddenCategory option:selected").text())//隐患类别
        console.log($("#sourceDanger option:selected").text())//隐患来源
    });

    var pathImg;//后台返回的图片路径
    var pathImgArr = [];//后台返回的图片路径的数组
    var arrBefore;//给后台传的值隐患
    var pathImgAfter;//存后台的路径
    var pathImgArrAfter = [];//整改后的图片路径的数组
    var arrAfter;//给后台传的值整理后的

    //上传图片隐患照片
    var $list=$("#thelist");   //初始化全局
    var thumbnailWidth = 50;   //缩略图高度和宽度 （单位是像素），当宽高度是0~1的时候，是按照百分比计算
    var thumbnailHeight = 50;
    var uploaderImg = WebUploader.create({
        // 选完文件后，是否自动上传。
        auto: true,
        swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
        server: "{:url('Upload/upload')}",// 文件接收服务端。
        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#filePicker',

        // 只允许选择图片文件。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/*'
        },
        method:'POST',
    });
    // 当有文件添加进来的时候
    uploaderImg.on( 'fileQueued', function( file ) {  // webuploaderImg事件.当选择文件后，文件被加载到文件队列中，触发该事件。等效于 uploaderImg.onFileueued = function(file){...} ，类似js的事件定义。
        var $li = $(
            '<div id="' + file.id + '" class="file-item thumbnail">' +
            '<img>' +
            '<div class="info">' + file.name + '</div>' +
            '<div class="infoDel"><span onclick="delFileName(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span></div>' +
            '</div>'
            ),
            $img = $li.find('img');
        // $list为容器jQuery实例
        $list.append( $li );

        // 创建缩略图
        // 如果为非图片文件，可以不用调用此方法。
        // thumbnailWidth x thumbnailHeight 为 100 x 100
        uploaderImg.makeThumb( file, function( error, src ) {   //webuploaderImg方法
            if ( error ) {
                $img.replaceWith('<span>不能预览</span>');
                return;
            }
            $img.attr( 'src', src );
        }, thumbnailWidth, thumbnailHeight );
    });
    function delFileName(that) {
        var id = $(that).parent("div").attr("id");
        $("#"+id).remove();
    }
    // 文件上传过程中创建进度条实时显示。
    uploaderImg.on( 'uploadProgress', function( file, percentage ) {
        var $li = $( '#'+file.id ),
            $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
            $percent = $('<p class="progress"><span></span></p>')
                .appendTo( $li )
                .find('span');
        }

        $percent.css( 'width', percentage * 100 + '%' );
    });
    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
    uploaderImg.on( 'uploadSuccess', function( file ,res) {
        $( '#'+file.id ).addClass('upload-state-done');
        console.log(res);
//        if(res.code ==1){
//            layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});

        pathImg = res.data;//图片路径
        pathImgArr.push(pathImg);
        arrBefore = pathImgArr.join("※");
        console.log(arrBefore)
        console.log(pathImg)
        console.log(pathImgArr)
//        }else {
//            layer.msg(res.msg,{time:1500});
//            return false;
//        }
    });
    // 文件上传失败，显示上传出错。
    uploaderImg.on( 'uploadError', function( file ) {
        var $li = $( '#'+file.id ),
            $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
            $error = $('<div class="error"></div>').appendTo( $li );
        }

        $error.text('上传失败');
    });
    // 完成上传完了，成功或者失败，先删除进度条。
    uploaderImg.on( 'uploadComplete', function( file ) {
        $( '#'+file.id ).find('.progress').remove();
    });

    //整理后的图片
    var $listAfter=$("#thelistAfter");   //初始化全局
    var thumbnailWidth = 50;   //缩略图高度和宽度 （单位是像素），当宽高度是0~1的时候，是按照百分比计算，
    var thumbnailHeight = 50;
    var uploaderImgAfter = WebUploader.create({
        // 选完文件后，是否自动上传。
        auto: true,
        swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
        server: "{:url('Upload/upload')}",// 文件接收服务端。
        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#filePickerAfter',

        // 只允许选择图片文件。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/*'
        },
        method:'POST',
    });
    // 当有文件添加进来的时候
    uploaderImgAfter.on( 'fileQueued', function( file ) {  // webuploaderImg事件.当选择文件后，文件被加载到文件队列中，触发该事件。等效于 uploaderImgAfter.onFileueued = function(file){...} ，类似js的事件定义。
        var $li = $(
            '<div id="' + file.id + '" class="file-item thumbnail">' +
            '<img>' +
            '<div class="info">' + file.name + '</div>' +
            '<div class="infoDel"><span onclick="delFileNameAfter(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span></div>' +
            '</div>'
            ),
            $img = $li.find('img');
        // $listAfter为容器jQuery实例
        $listAfter.append( $li );

        // 创建缩略图
        // 如果为非图片文件，可以不用调用此方法。
        // thumbnailWidth x thumbnailHeight 为 100 x 100
        uploaderImgAfter.makeThumb( file, function( error, src ) {   //webuploaderImg方法
            if ( error ) {
                $img.replaceWith('<span>不能预览</span>');
                return;
            }
            $img.attr( 'src', src );
        }, thumbnailWidth, thumbnailHeight );
    });
    function delFileNameAfter(that) {
        var id = $(that).parent("div").attr("id");
        $("#"+id).remove();
    }
    // 文件上传过程中创建进度条实时显示。
    uploaderImgAfter.on( 'uploadProgress', function( file, percentage ) {
        var $li = $( '#'+file.id ),
            $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
            $percent = $('<p class="progress"><span></span></p>')
                .appendTo( $li )
                .find('span');
        }

        $percent.css( 'width', percentage * 100 + '%' );
    });
    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
    uploaderImgAfter.on( 'uploadSuccess', function( file ,res) {
        $( '#'+file.id ).addClass('upload-state-done');
        console.log(res);
//        if(res.code ==1){
//            layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});

        pathImgAfter = res.data;//图片路径
        pathImgArrAfter.push(pathImgAfter);
        arrAfter = pathImgArrAfter.join("※");
        console.log(arrAfter)
        console.log(pathImgAfter)
        console.log(pathImgArrAfter)
//        }else {
//            layer.msg(res.msg,{time:1500});
//            return false;
//        }
    });
    // 文件上传失败，显示上传出错。
    uploaderImgAfter.on( 'uploadError', function( file ) {
        var $li = $( '#'+file.id ),
            $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
            $error = $('<div class="error"></div>').appendTo( $li );
        }

        $error.text('上传失败');
    });
    // 完成上传完了，成功或者失败，先删除进度条。
    uploaderImgAfter.on( 'uploadComplete', function( file ) {
        $( '#'+file.id ).find('.progress').remove();
    });

    //清空数据
    function resetAll() {
        $("#memberAdd").find('input[type=text],select,input[type=hidden],textarea').each(function() {
                $(this).val('');
             });
    }
    //新增的保存
    $("#memberAdd").submit(function (){
        console.log($("#riskId").val())
        console.log($("#liabilitySection option:selected").text())//标段
        console.log($("#hiddenCategory option:selected").text())//隐患类别
        console.log($("#sourceDanger option:selected").text())//隐患来源
        console.log(arrBefore)//隐患来源
        console.log(arrAfter)//隐患来源
        if(arrBefore != '' && arrAfter != ''){
            if($("#riskId").val() == ''){
                console.log("新增BAO")
                $.ajax({
                        url: "./addOrEdit",
                        type: "post",
                        data: {
                            id:$("#riskId").val(),
                            context:$("#riskText").val(),//隐患内容
                            part:$("#hiddenPart").val(),//隐患部位
                            section:$("#liabilitySection option:selected").text(),//标段
                            cat:$("#hiddenCategory option:selected").text(),//隐患类别
                            source:$("#sourceDanger option:selected").text(),//隐患来源
                            founddate:$("#dateDiscovery").val(),//发现日期
                            founder:$("#discovery").val(),//发现人
                            level:$("#hiddenGrade option:selected").text(),//隐患等级
                            govern:$("#goveMeasures").val(),//治理措施,
                            governdate:$("#timeLimit").val(),//治理时限
                            workdutyer:$("#personLiable").val(),//施工责任人
                            completedate:$("#completionTime").val(),//治理完成时间
                            risk_img:arrBefore,//隐患治理前照片
                            acceptor:$("#acceptor").val(),//验收人
                            risk_after_img:arrAfter//隐患治理后照片
                        },
                        datatype: "json",
                        success: function (res) {
                            if(res.code === 1){
                                layer.msg(res.msg);
                                admin_table.ajax.url("__SCRIPT__/safety_risk.php").load();
                                $("#risk_modal").modal('hide');
                                resetAll();
                                $("#thelist").html('');
                                $("#thelistAfter").html('');
                            }else {
                                layer.msg(res.msg);
                            }
                        }
                    })
            }else if($("#riskId").val() != ''){
                console.log("编辑BAO")
                console.log(333333333333333)
                $.ajax({
                    url: "./addOrEdit",
                    type: "post",
                    data: {
                        id : $("#riskId").val(),//id
                        context:$("#riskText").val(),//隐患内容
                        part:$("#hiddenPart").val(),//隐患部位
                        section:$("#liabilitySection option:selected").text(),//标段
                        cat:$("#hiddenCategory option:selected").text(),//隐患类别
                        source:$("#sourceDanger option:selected").text(),//隐患来源
                        founddate:$("#dateDiscovery").val(),//发现日期
                        founder:$("#discovery").val(),//发现人
                        level:$("#hiddenGrade option:selected").text(),//隐患等级
                        govern:$("#goveMeasures").val(),//治理措施,
                        governdate:$("#timeLimit").val(),//治理时限
                        workdutyer:$("#personLiable").val(),//施工责任人
                        completedate:$("#completionTime").val(),//治理完成时间
                        acceptor:$("#acceptor").val(),//验收人
                        risk_img:arrBefore,//隐患治理前照片
                        risk_after_img:arrAfter//隐患治理后照片

                    },
                    datatype: "json",
                    success: function (res) {
                        if(res.code === 1){
                            layer.msg(res.msg);
                            admin_table.ajax.url("__SCRIPT__/safety_risk.php").load();
                            $("#risk_modal").modal('hide');
                        }else {
                            layer.msg(res.msg);
                        }
                    }
                })
            }
        }else{
            alert("请上传图片")
        }
    })
    //新增中的返回
    $("#risk_modal .btn-danger").click(function () {
        standard_uploader = null;
    });

    //编辑
    function riskEdit(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(2)").text();
        console.log(id);
        $("#risk_modal input").val("");
//        $("#id1").val(id);
        $("#file_list1").empty();
        $("#risk_modal h5").text("编辑");
        $("#risk_modal").modal("show");
        $.ajax({
            url: "./index",
            type: "post",
            data: {id:id},
            dataType: "json",
            success: function (res) {
                console.log(res);
//                if(res.code === 1){
                console.log(12345678+"获取一条数据");
                    $("#riskId").val(res.id);
                    $("#riskText").val(res.context);//隐患内容
                    $("#hiddenPart").val(res.part);//隐患部位
                    $("#liabilitySection option:selected").text(res.section);//标段
                    $("#hiddenCategory option:selected").text(res.cat);//隐患类别
                    $("#sourceDanger option:selected").text(res.source);//隐患来源
                    $("#dateDiscovery").val(res.founddate);//发现日期
                    $("#discovery").val(res.founder);//发现人
                    $("#hiddenGrade option:selected").text(res.level);//隐患等级
                    $("#goveMeasures").val(res.govern);//治理措施;
                    $("#timeLimit").val(res.governdate);//治理时限
                    $("#personLiable").val(res.workdutyer);//施工责任人
                    $("#completionTime").val(res.completedate);//治理完成时间
                    $("#acceptor").val(res.acceptor);//验收人
                    console.log(res.risk_img_before[0].path)
                    var strImgBefore = res.risk_img_before[0].path;
                    var strImgAfter = res.risk_img_after[0].path;
                    $("#thelist").append('<div class="file-item thumbnail">' +
                        '<img style="width: 50px;height: 50px;" src="'+strImgBefore.substring(1)+'">' +
                        '<div class="info"></div>' +
                        '<div class="infoDel"><span onclick="delFileNameBefore(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span></div>' +
                        '</div>');

                    //整理后的
                    $("#thelistAfter").append('<div class="file-item thumbnail">' +
                        '<img style="width: 50px;height: 50px;" src="'+strImgAfter.substring(1)+'">' +
                        '<div class="info"></div>' +
                        '<div class="infoDel"><span onclick="delFileNameAfter(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span></div>' +
                        '</div>');
            }
        })
    }
    //隐患治理-编辑-删除上传的文件
    function fdelatt1(that) {
        var id = $(that).parent("div").attr("id");
        $("#"+id).remove();
    }

    //隐患治理-点击删除
    function del(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(2)").text();
        console.log(id)
        layer.confirm('确认删除此条记录吗?', {icon: 3, title:'提示'}, function(index){
            $.ajax({
                url: "./rulesDel",
                data: {'id' : id},
                type: "post",
                dataType: "json",
                success: function (res) {
                    if(res.code == 1){
                        layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});
                        admin_table.ajax.url("__SCRIPT__/safety_rules.php?pid=" + groupid).load();
//                        cid = "";
                    }else{
                        layer.msg(res.msg,{icon:0,time:1500,shade: 0.1});
                    }
                }
            })
            layer.close(index);
        })
    }

    //导入excelImport
    var uploaderExcel;
    uploaderExcel = WebUploader.create({
        auto: true,// 选完文件后，是否自动上传。
        swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
        server: "{:url('Rulesregulations/importExcel')}",// 文件接收服务端。
        chunked: false,
        fileSizeLimit: 1000 *1024 *1024,
        fileNumLimit: 1,
        formData: {
            group_id:''
        },
        duplicate: true,// 重复上传图片，true为可重复false为不可重复
        pick: {
            multiple: false,
            id: "#excelImport",
            innerHTML: "导入"
        }
    });
    uploaderExcel.on( 'uploadSuccess', function( file ,res) {
        complete(res);
    });
    function complete(data){
        console.log(data);
        if(data.code === 1){
            console.log(groupid+77777777)
            layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
            admin_table.ajax.url("__SCRIPT__/safety_rules.php?pid=" + groupid).load();
        }else {
            layer.msg('导入数据失败!');
            return false;
        }
    }
    uploaderExcel.on( 'uploadError', function( file ) {
        alert('上传出错');
    });
    // 文件上传过程中创建进度条实时显示。
    uploaderExcel.on('uploadProgress', function (file, percentage) {
        var $li = $('#' + file.id),
            $percent = $li.find('.progress .progress-bar');
        // 避免重复创建
        if (!$percent.length) {
            $percent = $('<div class="progress progress-striped active">' +
                '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                '</div>' +
                '</div>').appendTo($li).find('.progress-bar');
        }
        $li.find('p.state').text('上传中');
        $percent.css('width', percentage * 100 + '%');
    });
    uploaderExcel.on("uploadStart",function () {
        uploaderExcel.options.formData.group_id = groupid;
    });
    uploaderExcel.on("uploadFinished", function () {
        uploaderExcel.reset();
    });
    //驱虫
    Array.prototype.removal = function(){
        var newArr = [];
        for (var i = 0; i < this.length; i++) {
            if(newArr.indexOf(this[i]) == -1){  //判断在newArr数组中是否存在，不存在则push到newArr数组中 indexOf 不兼容IE8及以下
                newArr.push(this[i]);
            }
        }
        return newArr;
    }
    //删除数组中的指定元素
    Array.prototype.remove = function(val){
        for (var i = 0; i < this.length; i++) {
            if(this[i] === val){
                this.splice(i,1);
                break;
            }
        }
        return this;
    }
    var dataArr=[];
    //获取选中行ID
    function getDataId(that) {
        var isChecked = $(that).prop('checked');
        var id = $(that).parents('tr').find('td:eq(1)').text();
        if(isChecked){
            dataArr.push(id);
            dataArr.removal(id);
        }else {
            dataArr.remove(id);
            dataArr.removal(id);
        }
    }
    //单选
    function getRadioId(that) {
        getDataId(that);
        console.log(dataArr);
    }
    //checkbox全选
    $(".checkall").on("click", function () {
        if ($(this).prop("checked") == true) {
            var check = $(this).prop("checked");
            $(".checkchild").prop("checked", check);
            $(".checkchild").each(function(){
                getDataId(this);
            });
        } else {
            $(".checkchild").prop("checked", false);
            $(".checkchild").each(function(){
                getDataId(this);
            });
        }
        console.log(dataArr);
    });
    //导出excelExport
    $("#excelExport").click(function () {
        if(dataArr.length != ''){
            $.ajax({
                url: "./exportExcel",
                type: "post",
                data: {
                    majorKeyArr:dataArr
                },
                dataType: "json",
                success: function (res) {
                    if(res.code ==1){
                        $("#form_container").empty();
                        var str = '<iframe name="exportExcelFrame" style="display:none;"></iframe>'
                            +'<form action="./exportExcel" method="get" target="exportExcelFrame">';
                        for (var i = 0; i < dataArr.length; i++) {
                            str += '<input style="display: none;" name="majorKeyArr[]" value="'+ dataArr[i] +'">';
                        }
                        str += '<button type="submit" id="exportExcelBtn"></button></form>';
                        $("#form_container").append(str);
                        $("#form_container").find("#exportExcelBtn").click();
                        layer.msg('导出成功！', {icon: 1,time: 1500});
                    }else if(res.code == -1){
                        layer.msg(res.msg);
                        console.log(res.msg)
                    }else{
                        alert("获取数据失败！")
                    }
                }
            })
        }else {
            layer.msg('请选择要导出的数据！', {time: 1000})
        }
    });
    //导出excel模版 moldPlate
    $("#moldPlate").click(function () {
        $.ajax({
            url: "./exportExcelTemplete",
            type: "post",
            dataType: "json",
            success: function (res) {
                if(res.code ==1){
                    $("#form_ExportMold").empty();
                    var str = '<iframe name="ExcelFrame" style="display:none;"></iframe>'
                        +'<form action="./exportExcelTemplete" method="get" target="ExcelFrame">';
                    str += '<button type="submit" id="ExcelBtnMold"></button></form>';
                    $("#form_ExportMold").append(str);
                    $("#form_ExportMold").find("#ExcelBtnMold").click();
                    layer.msg('导出成功！', {icon: 1});
                }else{
                    alert("获取数据失败！")
                }
            }
        })
    });


/*------ 一岗双责 -----*/

    $("#aPairOf").text('一岗双责');
    //点击一岗双责
    $("#aPairOf").click(function () {
        $(".aPairOf_risk").show();
        $(".wrapper").hide();
        $("#aPairOf_wrapper .rePath").text("返回");
        console.log($("#aPairOf_wrapper .rePath").text())
    });
    //点击返回
    $(".rePath").click(function (e) {
        e.preventDefault();
        $(".aPairOf_risk").hide();
        $(".wrapper").show();
    })

    var aPairOf_table = $('#aPairOf_table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "__SCRIPT__/safety_riskduty.php"
        },
        "dom": '<"selectyear"><"myl"l><"float_left"f>tip',
        "columnDefs": [
            {
                "searchable": false,
                "orderable": false,
                "targets": [5],
                "render" :  function(data,type,row) {
                    var html = "<input type='button' class='btn btn-info btn-outline btn-xs' style='margin-left: 5px;' onclick='riskreduceSee(this)' value='查看'/>";
                    html += "<input type='button' class='btn btn-success btn-outline btn-xs' style='margin-left: 5px;' onclick='riskreduceSetUp(this)' value='设置'/>" ;
                    return html;
                }
            }
        ],
        "language": {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    } );

    //得分查看
    function riskreduceSee() {
        $("#aPairOf_modal h5").text("查看");
        $("#aPairOf_modal").modal('show');
    }
    //得分查看返回
    $("#aPairOf_modal .btn-danger").click(function () {
        standard_uploader = null;
    });
    //减分设置
    function riskreduceSetUp() {
        $("#aPairOf_reduce_modal h5").text("设置");
        $("#aPairOf_reduce_modal").modal('show');
    }
    //减分时间插件
    $("#reduce1").jeDate({format: "YYYY-MM-DD"});
    $("#reduce2").jeDate({format: "YYYY-MM-DD"});
    $("#reduce3").jeDate({format: "YYYY-MM-DD"});
    $("#reduce4").jeDate({format: "YYYY-MM-DD"});
    $("#reduce5").jeDate({format: "YYYY-MM-DD"});
    $("#reduce6").jeDate({format: "YYYY-MM-DD"});
    $("#reduce7").jeDate({format: "YYYY-MM-DD"});
    //减分设置返回
    $("#aPairOf_reduce_modal .btn-danger").click(function () {
        standard_uploader = null;
    });
    //上传插件
    var aname1,aname2;   //用于区分 编辑时是否修改了文件
    var uploader1;
    function upload1() {
        if(!uploader1){
            uploader1 = WebUploader.create({
                auto: false,// 选完文件后，是否自动上传。
                swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('Upload/uploadRules')}",// 文件接收服务端。
                chunked: false,
                fileSizeLimit: 1000 *1024 *1024,
                fileNumLimit: 1,
//                formData: {"remark":"","aid":""},
                duplicate :true,// 重复上传图片，true为可重复false为不可重复
                pick: {
                    multiple: false,
                    id: "#file_upload1",
                    innerHTML: "上传文件"
                }
            });
            //点击新增出现--上传文件
            uploader1.on( 'fileQueued', function( file ) {
                aname2 = file.name;
                $("#file_per1").append('<div id="' + file.id + '" class="item">' +
                    '</div>');
                $("#file_list1").append('<div style="display: inline-block;vertical-align: middle;width: 100%;height: 100%;" class="' + file.id + '" class="item">' +
                    '<span class="info" style="padding-left: 10px;"><input class="infoText" style="height: 38px;" type="text" value="' + file.name + '"/></span>&nbsp' +
                    '<span class="webuploadDelbtn" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;padding-left: 5px;">删除</span>' +
                    '</div>' );
            });
            $("#file_list1").on("click", ".webuploadDelbtn", function () {
                var $ele = $(this);
                var id = $ele.parent().attr("class");
                var file = uploader1.getFile(id);
                uploader1.removeFile(file,true);
            });
            uploader1.on('fileDequeued', function (file) {
                $(file.id).remove();
                $('.'+file.id).remove();
                console.log("remove");
            });
            uploader1.on("uploadStart",function () {
                console.log(groupid)
                uploader1.options.formData.id = $("#rulesid").val();//id
                uploader1.options.formData.group_id = groupid;//group_id
                uploader1.options.formData.number = $("#standardNumr").val();//标准号
                uploader1.options.formData.rul_name = $("#file_list1 .info .infoText").val();//名称
                uploader1.options.formData.go_date = $("#dataImple").val();//施行日期
                uploader1.options.formData.standard = $("#alternativeStandard").val();//替代标准
                uploader1.options.formData.evaluation = $("#appEvaluation").val();//适用性评价
                uploader1.options.formData.rul_user = $("#recogner").val();//识别人
                uploader1.options.formData.remark = $("#rulesDesc").val()//备注
            });
            uploader1.on('beforeFileQueued', function (file) {
                if($("#file_list1").html()){
                    alert("只能上传一个文件,请先删除文件");
                    return false;
                }else {
                    return true;
                }
            });
            // 文件上传过程中创建进度条实时显示。
            uploader1.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress .progress-bar');
                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<div class="progress progress-striped active">' +
                        '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                        '</div>' +
                        '</div>').appendTo($li).find('.progress-bar');
                }
                $li.find('p.state').text('上传中');
                $percent.css('width', percentage * 100 + '%');
            });
            // 文件上传成功
            uploader1.on( 'uploadSuccess', function( file,data, response ) {
                console.log(file)
                console.log(data)
                if(data.code === 1){
                    console.log(groupid+77777777)
                    layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
                    $("#file_upload1").empty();
                    $("#file_per1").empty();
                    $("#file_list1").empty();
                    $("#risk_modal").modal('hide');
                    admin_table.ajax.url("__SCRIPT__/safety_rules.php?pid=" + groupid).load();
                }else {
                    layer.msg("抱歉，您没有此权限");
                }
            });
            // 文件上传失败，显示上传出错。
            uploader1.on( 'uploadError', function( file ) {
                layer.msg("上传失败",{icon:2,time:1500,shade: 0.1});
                $("#file_per1").empty();
            });
        }
    }



</script>
