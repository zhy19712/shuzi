{include file="public/header" /}
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/webuploader.css">
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/style.css">
<link rel="stylesheet" href="/static/admin/css/zTreeStyle/zTreeStyle.css">
<link rel="stylesheet" href="/static/admin/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/static/admin/css/jedate.css">
<link rel="stylesheet" href="/static/admin/css/iconfont.css">
<style>
    #path{
        line-height: 30px;
        font-weight: 700;
        border-bottom: 1px solid #000;
    }
    .ztree li a.level0 {width:100%;height: 30px; text-align: center; display:block; background-color: #0B61A4; border:1px silver solid;}
    .ztree li a.level0.cur {background-color: #66A3D2; }
    .ztree li a.level0 span {display: block; color: white; padding-top:3px; font-size:12px; font-weight: bold;word-spacing: 2px;}
    .ztree li a.level0 span.button {	float:right; margin-left: 10px; visibility: visible;display:none;}
    .ztree li span.button.switch.level0 {display:none;}

    .mybtn{
        float: left;
        margin-right: 20px;
        margin-top: 5px;
    }

    .dataTables_wrapper .dataTables_length , .dataTables_wrapper .dataTables_filter{
        margin-top: 10px;
    }

    .dataTable thead  tr th:first-child:after{
        content: ""!important;
        display: none!important;
    }
    .file-item{
        float: left;
    }
    .excel{
        width: 390px;
        height: 33px;
        position: absolute;
        right: 230px;
        top: 5px;
        z-index: 4;
    }
    .excel select{
        margin-left: 10px;
        width: 100px;
    }
    .tab-pane{
        position:relative;
    }
    .msg{
        font-weight: 400;
        line-height: 30px;
        padding: 8px 0;
        position: absolute;
        text-align: center;
        width: 96%;
        color: red;
    }
    .myp{
        background-color: #bae2f3;
        font-weight: 700;
        line-height: 30px;
        padding: 8px 0;
        position: absolute;
        text-align: center;
        width: 78%;
        left: 11%;
    }
</style>
<body class="gray-bg animated fadeInRight" style="background-color:#fff;">

<div id="mycontent" style="width: 20%;height: 98%;display: inline-block;background-color:#fff;overflow-x: scroll;padding-right:0px;border-right: 1px solid #ccc;">
    <!--<div id="file_per"></div>-->
    <!--<div id="file_list"></div>-->
    <div id="tree_container" class="ztree"></div>
    <p style="display: none;"></p>
</div>
{include file="public/footer" /}
<script type="text/javascript" src="/static/admin/webupload/webuploader.min.js"></script>

<script src="__JS__/jquery.ztree.all.js"></script>
<script src="__JS__/jquery.dataTables.min.js"></script>
<script src="__JS__/jquery.jedate.js"></script>

<script type="text/javascript">
    //获取选中行ID
    var dataArr=[];
    var $check_table; //全选的表格
    //
    $("thead tr th:first-child").unbind();
    // var curMenu = null, zTree_Menu = null;
    //组织结构
    var zTreeObj;
    var selfid;

    //点击获取路径
    function onClick(e, treeId, node) {
        $("#path").text("");
        var sNodes = zTreeObj.getSelectedNodes();//选中节点
        selfid = zTreeObj.getSelectedNodes()[0].id
        var path = sNodes[0].name; //选中节点的名字
        node = sNodes[0].getParentNode();//获取父节点

        //判断是否还有父节点
        if (node) {
            //判断是否还有父节点
            while (node){
                path = node.name + ">>" + path;
                node = node.getParentNode();
            }
        }else{
            $("#path").text(sNodes[0].name);
        }
        //判断是否拉数据
        var groupid = sNodes[0].pId //父节点的id
        if (!sNodes[0].children && groupid !== 1 && groupid !== 12 && groupid !== 13){
            switch (Number(groupid)){
                case 11 :
                    table1.ajax.url("__SCRIPT__/safety_equipmentmanage.php?selfid=" + selfid).load();
                    $("#mytable1_wrapper").css("display","block");
                    break;
                case 121:
                case 122:
                case 123:
                case 124:
                    table2.ajax.url("__SCRIPT__/safety_equipmentmanage.php?selfid=" + selfid).load();
                    $("#mytable2_wrapper").css("display","block");
                    break;
                case 131:
                    vision_getinit('../Specialequipmentmanagement/getversion');
                    table3.ajax.url("__SCRIPT__/safety_special_equipment_management.php?selfid=" + selfid).load();
                    $("#mytable3_wrapper").css("display","block");
                    break;
                case 132:
                    vision_getinit('../Trafficvehicle/getversion');
                    table5.ajax.url("__SCRIPT__/safety_trafficvehicle.php?selfid=" + selfid).load();
                    $("#mytable5_wrapper").css("display","block")
                    break;
                case 133:
                case 2 :
                    if(selfid==21){
                        vision_getinit('../Vehiclemanagement/getversion');
                        table9.ajax.url("__SCRIPT__/safety_vehiclemanagement.php?selfid=" + selfid).load();
                        $("#mytable9_wrapper").css("display","block");
                    }
                    break;
            }
        }
        $("#path").text("当前路径:"+path)
    }
    //配置信息
    var setting = {
        view: {
            showLine: true, //设置 zTree 是否显示节点之间的连线。
            selectedMulti: false, //设置是否允许同时选中多个节点。
            dblClickExpand: true //双击节点时，是否自动展开父节点的标识。
        },
        async: {
            enable : true,
            autoParam: ["pId"],
            type : "post",
            url : "./index",
            dataType :"json"
        },
        data:{
            keep: {
                leaf : true,
                parent : true
            },
            simpleData : {
                enable:true,
                idkey: "id",
                pIdKey: "pId",
                rootPId:0
            }
        },
        callback: {
            // beforeClick: this.beforeClick,
            onClick: this.onClick

        }
    };
    //点击前
    // function beforeClick(treeId, node) {
    //     if (node.isParent) {
    //         if (node.level === 0) {
    //             var pNode = curMenu;
    //             while (pNode && pNode.level !==0) {
    //                 pNode = pNode.getParentNode();
    //             }
    //             if (pNode !== node) {
    //                 var a = $("#" + pNode.tId + "_a");
    //                 a.removeClass("cur");
    //                 zTree_Menu.expandNode(pNode, false);
    //             }
    //             a = $("#" + node.tId + "_a");
    //             a.addClass("cur");
    //
    //             var isOpen = false;
    //             for (var i=0,l=node.children.length; i<l; i++) {
    //                 if(node.children[i].open) {
    //                     isOpen = true;
    //                     break;
    //                 }
    //             }
    //             if (isOpen) {
    //                 zTree_Menu.expandNode(node, true);
    //                 curMenu = node;
    //             } else {
    //                 zTree_Menu.expandNode(node.children[0].isParent?node.children[0]:node, true);
    //                 curMenu = node.children[0];
    //             }
    //         } else {
    //             zTree_Menu.expandNode(node);
    //         }
    //     }
    //     return !node.isParent;
    // }
    //初始化
    zTreeObj = $.fn.zTree.init($("#tree_container"), setting,null);
    // zTree_Menu = $.fn.zTree.getZTreeObj("tree_container");
    // curMenu = zTree_Menu.getNodes();//获取 zTree 的全部节点数据
</script>
</body>
</html>