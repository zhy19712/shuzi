<link rel="stylesheet" type="text/css" href="/static/admin/webupload/webuploader.css">
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/style.css">
<link rel="stylesheet" href="/static/admin/css/zTreeStyle/zTreeStyle.css">
<link rel="stylesheet" href="/static/admin/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/static/admin/css/jedate.css">
<link rel="stylesheet" href="/static/admin/css/iconfont.css">
<link rel="stylesheet" href="/static/admin/css/bootstrap.min.css">
{include file="public/header" /}
<body>
    <style>
        .mycontent{
            width: 20%;
            height: 98%;
            display: inline-block;
            background-color: #fff;
            overflow-x: scroll;
            border-right: 1px solid #ccc;
        }
        .mycontent h2{
            font-size: 16px;
            border-bottom: 1px solid #ccc;
            margin: 0;
            padding: 10px 0;
            text-align: center;
        }
        .ztree li span.button.add {
            margin-left:2px;
            margin-right: -1px;
            background-position:-144px 0;
            vertical-align:top;
            *vertical-align:middle;
        }
        .wrapper {
            display: inline-block;
            width: 78%;
            vertical-align: top;
            padding: 0;
        }
        #path{
            line-height: 30px;
            font-weight: 700;
            border-bottom: 1px solid #ccc;
        }
        .dataTables_wrapper .dataTables_filter{
            float: left;
        }
        .dt-buttons{
            float: right;
            margin-top: 5px;
        }
        .btn-primary{
            background-color: none !important;
            border-color: none !important;
        }
        .btn-upload{
            padding: 0;
            margin: 0;
            height: 34px;
        }
        .btn-upload .webuploader-pick{
            padding: 7px 15px;
            border-radius:0;
        }
        #tableItem .btn{
            margin-right: 2px;
        }
    </style>

    <div id="mycontent" class="mycontent">
        <h2>法律标准分类</h2>
        <ul id="tree_container" class="ztree"></ul>
    </div>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="row">
                    <div id="path">当前路径:</div>
                    <div id="table_info">
                        <div id="level">
                            <table id="tableItem" class="table table-striped table-bordered" cellspacing="0"  width="100%">

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="addRules_modal" data-keyboard="false" data-backdrop="static" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 60%;margin: 0 auto;margin-top: 40px;">
        <div class="row">
            <div class="col-sm-12" style="background-color:#fff;">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5></h5>
                    </div>
                    <input type="text" name="uid" id="id1" style="display: none;" value="">
                    <div class="ibox-content">
                        <!--新增用户信息开始-->
                        <form class="form-horizontal" name="memberAdd" id="memberAdd" method="post" action="{:url('memberAdd')}">
                            <input type="text" name="id" id="sid" style="display: none;">
                            <input type="text" name="group_id" id="pgroup_id" style="display: none;">
                            <div class="form-group">
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label col-sm-offset-2 col-xs-offset-0">标准号：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <input id="standardNumr" type="text" class="form-control" name="standardNumr" >
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-3 col-sm-3 control-label">名称：</label>
                                    <div class="myblock col-xs- input-group">
                                        <input id="addName" type="text" class="form-control" name="addName" >
                                        <span class="input-group-btn">
                                            <div class="btn btn-upload" id="picker">上传</div>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label col-sm-offset-2 col-xs-offset-0">施行日期：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <input id="dataImple" type="text" class="form-control" name="dataImple" >
                                    </div>
                                </div>
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label">替代标准：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <input id="alternativeStandard" type="text" class="form-control" name="alternativeStandard" >
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-6 control-label col-xs-offset-0">适用性评价：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <select name="sex" id="psex" class="form-control" >
                                            <option value="适用">适用</option>
                                            <option value="过期">过期</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label">识别人：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <input id="pdivision" type="text" class="form-control" name="division" >
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="col-lg-12 col-xs-12">
                                <label class="col-xs-2 col-sm-2 control-label">备注：</label>
                                <div class="myblock col-xs-10 col-sm-10 input-group">
                                    <textarea name="rulesDesc" id="rulesDesc" style="width: 100%;min-height: 100px;"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-12 col-lg-12"  style="text-align: center;margin-top: 10px">
                                    <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                                </div>
                            </div>
                        </form>
                        <!--新增用户信息结束-->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
    </div>


    {include file="public/footer" /}
    <script type="text/javascript" src="/static/admin/webupload/webuploader.min.js"></script>

    <script src="__JS__/jquery.ztree.all.js"></script>
    <script src="__JS__/jquery.dataTables.min.js"></script>
    <script src="__JS__/dataTables.buttons.min.js"></script>
    <script src="__JS__/jquery.jedate.js"></script>
    <script src="__JS__/pdf.js"></script>
    <script src="__JS__/mypdf.js"></script>
    <script>
        //左侧菜单
        var node = [
            {name:"法律法规"},
            {name: "标准规范", children: [
                {name: "国家标准"},
                {name: "安监行业标准"},
                {name: "水利水电行业标准"},
                {name: "建筑行业标准"}
             ]}
        ]
        var setting = {
            view:{
                addHoverDom: addHoverDom,
                removeHoverDom: removeHoverDom,
            },
            edit:{
                enable: true,
                showRemoveBtn :true,
                showRenameBtn :true,
                removeTitle :"删除",
                renameTitle :"修改",
                drag:{
                    isMove:true,
                    prev:true,
                    next:true,
                    inner:true
                }
            },
            data:{
                keep: {
                    leaf : true,
                    parent : true
                },
                simpleData : {
                    enable:true,
                    idkey: "id",
                    pIdKey: "pId"
                }
            }
        };
        var newCount = 1;
        function addHoverDom(treeId, treeNode) {
            var sObj = $("#" + treeNode.tId + "_span");
            console.log(sObj);
            if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
            var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
                + "' title='add node' onfocus='this.blur();'></span>";
            sObj.after(addStr);
            var btn = $("#addBtn_"+treeNode.tId);

            if (btn) btn.bind("click", function(){
                var zTree = $.fn.zTree.getZTreeObj("tree_container");
                zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
                return false;
            });
        };
        function removeHoverDom(treeId, treeNode) {
            $("#addBtn_"+treeNode.tId).unbind().remove();
        };
        zTreeObj = $.fn.zTree.init($("#tree_container"), setting,node).expandAll(true);


        //右侧表格
        var dataSet = [
            ["1","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["2","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["3","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["4","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["5","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["6","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["7","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["8","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["9","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["10","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["11","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["12","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["13","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["14","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["15","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["16","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"],
            ["17","666","规范","2014年12月1日","适用","admin","2017年12月12日","无","修改"]
        ];
        var columns = [
            {
                title:"序号",
            },
            {
                title:"标准号",
            },
            {
                title:"名称",
            },
            {
                title:"施行日期",
            },
            {
                title:"适用性评价",
            },
            {
                title:"识别人",
            },
            {
                title:"上传日期",
            },
            {
                title:"备注",
            },
            {
                title:"操作",
            }
        ]
       $('#tableItem').DataTable({
            data:dataSet,
            columns:columns,
            columnDefs:[
                {
                    targets: 8,
                    render: function (data, type, row, meta) {
                        return '<a class="btn btn-success btn-xs" href="#" onclick=delFromID(' + row.id + ') >查询</a>' +
                                '<a class="btn btn-primary btn-xs" href="#" onclick=delFromID(' + row.id + ') >下载</a>' +
                                '<a class="btn btn-info btn-xs" href="#" onclick=delFromID(\' + row.id + \') >编辑</a>'+
                                '<a class="btn btn-danger btn-xs" href="#" onclick=delFromID(\' + row.id + \') >删除</a>';
                    }
                },
                {
                    "orderable": false,
                    "targets": 8
                }
            ],
            language: {
                "lengthMenu": "每页 _MENU_ 条记录",
                "zeroRecords": "没有找到记录",
                "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                "infoEmpty": "无记录",
                "infoFiltered": "(从 _MAX_ 条记录过滤)",
                "search":"搜索",
                "paginate": {
                    "first": "第一页",
                    "last": "最后一页",
                    "previous": "上一页",
                    "next": "下一页"
                }
            },
           dom: 'Bfrtip',
           buttons: [
               {
                   text: '上传',
                   className: 'btn btn-primary btn-xs upload',
               }
           ],
       });


        //上传弹层
        $(function(){
            $('.upload').on('click',function(){
                $('#addRules_modal').modal('show');
            });
            $('#dataImple').jeDate();
        })
        var uploader;
        //在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题
        $("#addRules_modal").on("shown.bs.modal",function(){
            uploader = WebUploader.create({
                auto: true,
                // swf文件路径
                swf:  '/static/admin/js/webupload/Uploader.swf',

                // 文件接收服务端。
                server: "{:url('Upload/uploadSdi')}",

                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: {
                    multiple: false,
                    id: "#picker",
                    innerHTML: "上传"
                },

                // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
                resize: false

            });
            var $list = $('#addName');
            uploader.on( 'fileQueued', function( file ) {
                $list.val('等待上传...');
            });

            uploader.on( 'uploadSuccess', function( file ) {
                $list.val(file.name+'已上传成功');
            });

            uploader.on( 'uploadError', function( file ) {
                $list.val('上传出错');
            });



        });
        //关闭模态框销毁WebUploader
        $('#addRules_modal').on('hide.bs.modal', function () {
            uploader.destroy();
        });
    </script>
</body>
</html>