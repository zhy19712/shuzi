{include file="public/header" /}
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/webuploader.css">
<link rel="stylesheet" type="text/css" href="/static/admin/webupload/style.css">
<link rel="stylesheet" href="/static/admin/css/zTreeStyle/zTreeStyle.css">
<link rel="stylesheet" href="/static/admin/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/static/admin/css/jedate.css">
<link rel="stylesheet" href="/static/admin/css/iconfont.css">
<style>
    #upload,#upload2,#upload3,#upload4,#upload5,#upload6,#upload7,#upload8,#upload9,#upload10,#upload11,#upload12,#upload13,#upload14,#upload15{
        position: absolute;
        right: 40px;
        margin-top: 8px;
        width: 88px;
        height: 30px;
        text-align: center;
        color: #fff;
        line-height: 30px;
        cursor: pointer;
        background-color: #00a2d4;
    }
    #mylist{
        float: right;
        font-size: 14px;
        font-weight: 700;
    }
    #upload_table_wrapper{
        padding: 0;
        padding-bottom: 3px;
    }
    #upload_table{
        margin-top: 46px;
    }
    .mytable{
        width: 100%;
        text-align: center;
        line-height: 34px;
        border-top: 1px solid #000;
        border-left: 1px solid #000;
    }
    .mytable td{
        border-right: 1px solid #000;
        border-bottom: 1px solid #000;
        padding: 0 10px;
    }
    .mytable td input{
        width: 100%;
        line-height: 20px;
        margin-bottom: 5px;
    }
    #content{
        margin: 0 auto;
        position: relative;
    }
    .mybtn,.mybtn1,.mybtn2{
        float: left;
        margin-right: 20px;
    }
    #qc_table td,#qc_table th{
        text-align: center;
    }
    #container{
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background-color: #fff;
    }
    #home>div{
        margin-top: 20px;
    }
    .myheader{
        height: 30px;
        line-height: 30px;
        text-align: center;
        margin-bottom: 10px;
    }
    .myheader p{
        font-weight: 700;
    }
    .exp{
        display: inline-block;
        vertical-align: middle;
        cursor: pointer;
    }
    .exp:first-child{
        color: #ff9933;
    }
    .exp>span{
        display: inline-block;
        vertical-align: middle;
        font-size: 18px;
    }
    #flow_content>div{
        /*display: none;*/
    }
    #flow_content>div:first-child{
        display: block;
    }
    .myp{
        background-color: #bae2f3;
        padding: 8px 0;
        position: absolute;
        width: 100%;
    }
    #container{
        /*display: none;*/
    }
    #img_show img,#pic_container img,#reason_container img{
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
    }
    #tab_li{
        font-size: 0;
    }
    #tab_li>div{
        display: inline-block;
        vertical-align: middle;
        width: 50%;
        text-align: center;
        border: 1px solid #ccc;
        font-size: 14px;
        line-height: 30px;
        cursor: pointer;
    }
    #tab_li>div:first-child{
        background-color: #bae2f3;
    }
    #tab_con>div:nth-child(2){
        /*display: none;*/
    }

    .ibox-content>.col-lg-12,.ibox-content>.col-lg-6{
        margin-top: 10px;
    }
    .pickerCon{
        color: black;
        position: absolute;
        top: 14px;
        left: 130px;
    }
</style>
<body>
    <div class="wrapper wrapper-content animated fadeInRight" style="display: inline-block;width: 96%;vertical-align: top;padding: 0;">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="row">
                    <div id="content">
                        <div id="container">
                            <ul class="nav nav-tabs" id="myTab">
                                <li class="active"><a href="#home">一岗双责绩效评定</a></li>
                                <li><a href="#profile">安全标准化评估报告</a></li>
                                <li><a href="#messages">安全文明施工年度工作总结</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="home">
                                    <div class="myheader">
                                        <div id="aPairOf">
                                            <table id="aPairOf_table" width="100%" class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>序号</th>
                                                        <th>文件名称</th>
                                                        <th>年度</th>
                                                        <th>季度</th>
                                                        <th>上传时间</th>
                                                        <th>上传人</th>
                                                        <th>备注</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="profile">
                                    <div class="myheader">
                                        <div id="safetyStandards">
                                            <table id="safetyStandards_table" width="100%" class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>序号</th>
                                                        <th>文件名称</th>
                                                        <th>上传时间</th>
                                                        <th>上传人</th>
                                                        <th>备注</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="messages">
                                    <div class="myheader">
                                        <div id="safetyCivilization">
                                            <table id="safetyCivilization_table" width="100%" class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>序号</th>
                                                        <th>文件名称</th>
                                                        <th>年度</th>
                                                        <th>上传时间</th>
                                                        <th>上传人</th>
                                                        <th>备注</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--文件下载-->
    <div id="formDown" style="display: none;"></div>
    <div id="form_container" style="display: none;"></div>
    <!--一岗双责新增-->
    <div id="aPairOf_modal" data-keyboard="false" data-backdrop="static" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 60%;margin: 0 auto;margin-top: 40px;">
        <div class="row">
            <div class="col-sm-12" style="background-color:#fff;">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5></h5>
                    </div>
                    <div class="ibox-content">
                        <!--新增用户信息开始-->
                        <form class="form-horizontal" name="memberAdd1" id="memberAdd1" method="post"  action="#" onsubmit="return false">
                            <input type="text" name="id" id="rulesid1" style="display: none;">
                            <input type="text" name="group_id" id="group_id1" style="display: none;">

                            <div class="form-group">
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label">年度：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <input id="aPairOfYear" type="text" class="form-control" name="aPairOfYear"  required="required" placeholder="此处为必填项">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-xs-12">
                                    <label class="col-xs-6 col-sm-4 control-label">季度：</label>
                                    <div class="myblock col-xs-6 input-group">
                                        <select name="aPairOfQuarter" id="aPairOfQuarter" class="form-control" >
                                            <option value="第一季度">第一季度</option>
                                            <option value="第二季度">第二季度</option>
                                            <option value="第三季度">第三季度</option>
                                            <option value="第四季度">第四季度</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-6 col-sm-2 control-label">文件名称：</label>
                                    <div class="myblock col-xs-6 col-sm-10 input-group">
                                        <div id="file_per_aPairOf" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_upload_aPairOf" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_list_aPairOf" style="display: inline-block;vertical-align: middle;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-2 col-sm-2 control-label">备注：</label>
                                    <div class="myblock col-xs-10 col-sm-10 input-group">
                                        <textarea name="rulesDesc" id="rulesDesc" style="width: 100%;min-height: 100px;"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-xs-12 col-lg-12"  style="text-align: center;margin-top: 10px">
                                    <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                                </div>
                            </div>
                        </form>
                        <!--新增用户信息结束-->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--安全标准化评估报告新增-->
    <div id="safetyStandards_modal" data-keyboard="false" data-backdrop="static" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 60%;margin: 0 auto;margin-top: 40px;">
        <div class="row">
            <div class="col-sm-12" style="background-color:#fff;">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5></h5>
                    </div>
                    <div class="ibox-content">
                        <!--新增用户信息开始-->
                        <form class="form-horizontal" name="memberAdd2" id="memberAdd2" method="post"  action="#" onsubmit="return false">
                            <input type="text" name="id" id="rulesid2" style="display: none;">
                            <input type="text" name="group_id" id="group_id2" style="display: none;">
                            <!--<div class="form-group">-->
                                <!--<div class="col-lg-12 col-xs-12">-->
                                    <!--<label class="col-xs-2 col-sm-2 control-label">上传人：</label>-->
                                    <!--<div class="myblock col-xs-10 col-sm-10 input-group">-->
                                        <!--<input id="standardsPerson" type="text" class="form-control" name="standardsPerson"  required="required" placeholder="此处为必填项">-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                            <!--<div class="hr-line-dashed"></div>-->
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-6 col-sm-2 control-label">文件名称：</label>
                                    <div class="myblock col-xs-6 col-sm-10 input-group">
                                        <div id="file_per_standards" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_upload_standards" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_list_standards" style="display: inline-block;vertical-align: middle;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-2 col-sm-2 control-label">备注：</label>
                                    <div class="myblock col-xs-10 col-sm-10 input-group">
                                        <textarea name="rulesDesc_standards" id="rulesDesc_standards" style="width: 100%;min-height: 100px;"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-xs-12 col-lg-12"  style="text-align: center;margin-top: 10px">
                                    <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                                </div>
                            </div>
                        </form>
                        <!--新增用户信息结束-->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--安全文明施工年度工作总结新增-->
    <div id="safetyCivilization_modal" data-keyboard="false" data-backdrop="static" class="modal animated fadeInRight" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 60%;margin: 0 auto;margin-top: 40px;">
        <div class="row">
            <div class="col-sm-12" style="background-color:#fff;">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5></h5>
                    </div>
                    <div class="ibox-content">
                        <!--新增用户信息开始-->
                        <form class="form-horizontal" name="memberAdd3" id="memberAdd3" method="post"  action="#" onsubmit="return false">
                            <input type="text" name="id" id="rulesid3" style="display: none;">
                            <input type="text" name="group_id" id="group_id3" style="display: none;">
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-6 col-sm-2 control-label">年度：</label>
                                    <div class="myblock col-xs-6 col-sm-10 input-group">
                                        <input id="civilYear" type="text" class="form-control" name="civilYear"  required="required" placeholder="此处为必填项">
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-6 col-sm-2 control-label">文件名称：</label>
                                    <div class="myblock col-xs-6 col-sm-10 input-group">
                                        <div id="file_per_civil" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_upload_civil" style="display: inline-block;vertical-align: middle;"></div>
                                        <div id="file_list_civil" style="display: inline-block;vertical-align: middle;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-lg-12 col-xs-12">
                                    <label class="col-xs-2 col-sm-2 control-label">备注：</label>
                                    <div class="myblock col-xs-10 col-sm-10 input-group">
                                        <textarea name="rulesDesc_civil" id="rulesDesc_civil" style="width: 100%;min-height: 100px;"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-xs-12 col-lg-12"  style="text-align: center;margin-top: 10px">
                                    <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> 保存</button>&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> 返回</a>
                                </div>
                            </div>
                        </form>
                        <!--新增用户信息结束-->

                    </div>
                </div>
            </div>
        </div>
    </div>

    {include file="public/footer" /}
<script type="text/javascript" src="/static/admin/webupload/webuploader.min.js"></script>
<script src="__JS__/jquery.ztree.all.js"></script>
<script src="__JS__/jquery.dataTables.min.js"></script>
<script src="__JS__/jquery.jedate.js"></script>

<script type="text/javascript">
    //tab切换
    $('#myTab a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
        console.log($(this).text());
    });
    //点击时间插件
    $("#trainingTime").jeDate({
        format: "YYYY-MM-DD"
    });
    //一岗双责绩效评定
    var aPairOf_table = $('#aPairOf_table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "__SCRIPT__/safety_evaluation.php?types=1"
        },
        "dom": '<"mybtn btn btn-outline btn-primary"><"myl"l><"float_left"f>tip',
        "columnDefs": [
            {
                "searchable": false,
                "orderable": false,
                "targets": [7],
                "render" :  function(data,type,row) {
                    var html = "<input type='button' class='btn btn-info btn-outline btn-xs' style='margin-left: 5px;' onclick='aPairOfDownload(this)' value='下载'/>";
                    html += "<input type='button' class='btn btn-success btn-outline btn-xs' style='margin-left: 5px;' onclick='aPairOfView(this)' value='预览'/>" ;
                    html += "<input type='button' class='btn btn-primary btn-outline btn-xs' style='margin-left: 5px;' onclick='aPairOfEdit(this)' value='编辑'/>" ;
                    html += "<input type='button' class='btn btn-danger btn-outline btn-xs' style='margin-left: 5px;' onclick='aPairOfDel(this)' value='删除'/>" ;
                    return html;
                }
            }
        ],
        "language": {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    } );
    $("div.mybtn").html('<div>新增</div>');
    //点击新增出现——一岗双责绩效评定modal
    $(".mybtn").click(function () {
        uploader1 = null;
        $("#aPairOf_modal input").val("");
        $("#rulesid1").val("")
        $("#rulesDesc").empty();
        $("#aPairOf_modal h5").text("新增");
        $("#aPairOf_modal").modal('show');
        upload1();
    });

    //安全标准化评估报告
    var safetyStandards_table = $('#safetyStandards_table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "__SCRIPT__/safety_evaluation.php?types=2"
        },
        "dom": '<"mybtn1 btn btn-outline btn-primary"><"myl"l><"float_left"f>tip',
        "columnDefs": [
            {
                "searchable": false,
                "orderable": false,
                "targets": [5],
                "render" :  function(data,type,row) {
                    var html = "<input type='button' class='btn btn-info btn-outline btn-xs' style='margin-left: 5px;' onclick='standardsDownload(this)' value='下载'/>";
                    html += "<input type='button' class='btn btn-success btn-outline btn-xs' style='margin-left: 5px;' onclick='standardsView(this)' value='预览'/>" ;
                    html += "<input type='button' class='btn btn-primary btn-outline btn-xs' style='margin-left: 5px;' onclick='standardsEdit(this)' value='编辑'/>" ;
                    html += "<input type='button' class='btn btn-danger btn-outline btn-xs' style='margin-left: 5px;' onclick='standardsDel(this)' value='删除'/>" ;
                    return html;
                }
            }
        ],
        "language": {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    } );
    $("div .mybtn1").html('<div>新增</div>');
    //点击新增出现——安全标准化评估报告modal
    $(".mybtn1").click(function () {
        uploader2 = null;
        $("#safetyStandards_modal input").val("");
        $("#rulesid2").val("")
        $("#rulesDesc_standards").empty();
        $("#rulesDesc_standards").val("");
        $("#safetyStandards_modal h5").text("新增");
        $("#safetyStandards_modal").modal('show');
        upload2();
    });
    var uploader2;
    function upload2() {
        if(!uploader2){
            uploader2 = WebUploader.create({
                auto: false,// 选完文件后，是否自动上传。
                swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('Upload/uploadEval')}",// 文件接收服务端。
                chunked: false,
                fileSizeLimit: 1000 *1024 *1024,
                fileNumLimit: 1,
//                formData: {"remark":"","aid":""},
                duplicate :true,// 重复上传图片，true为可重复false为不可重复
                pick: {
                    multiple: false,
                    id: "#file_upload_standards",
                    innerHTML: "上传文件"
                }
            });
            //点击新增出现--上传文件
            uploader2.on( 'fileQueued', function( file ) {
                aname2 = file.name;
                $("#file_per_standards").append('<div id="' + file.id + '" class="item">' +
                    '</div>');
                $("#file_list_standards").append('<div style="display: inline-block;vertical-align: middle;width: 100%;height: 100%;" class="' + file.id + '" class="item">' +
                    '<span class="info" style="padding-left: 10px;"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + file.name + '"/></span>&nbsp' +
                    '<span class="webuploadDelbtn" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;padding-left: 5px;">删除</span>' +
                    '</div>' );
            });
            $("#file_list_standards").on("click", ".webuploadDelbtn", function () {
                var $ele = $(this);
                var id = $ele.parent().attr("class");
                var file = uploader2.getFile(id);
                uploader2.removeFile(file,true);
            });
            uploader2.on('fileDequeued', function (file) {
                $(file.id).remove();
                $('.'+file.id).remove();
                console.log("remove");
            });
            uploader2.on("uploadStart",function () {
//                console.log($("#rulesid2").val())
                uploader2.options.formData.types = 2;//类型
                uploader2.options.formData.major_key= $("#rulesid2").val();//id
                uploader2.options.formData.eval_name = $("#file_list_standards .info .infoText").val();//文件名称
                uploader2.options.formData.remark = $("#rulesDesc_standards").val()//备注
            });
            uploader2.on('beforeFileQueued', function (file) {
                if($("#file_list_standards").html()){
                    alert("只能上传一个文件,请先删除文件");
                    return false;
                }else {
                    return true;
                }
            });
            // 文件上传过程中创建进度条实时显示。
            uploader2.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress .progress-bar');
                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<div class="progress progress-striped active">' +
                        '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                        '</div>' +
                        '</div>').appendTo($li).find('.progress-bar');
                }
                $li.find('p.state').text('上传中');
                $percent.css('width', percentage * 100 + '%');
            });
            // 文件上传成功
            uploader2.on( 'uploadSuccess', function( file,data ) {
                console.log(file)
                console.log(data)
                if(data.code === 1){
                    console.log(8888888)
                    layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
                    $("#file_upload_standards").empty();
                    $("#file_per_standards").empty();
                    $("#file_list_standards").empty();
                    $("#safetyStandards_modal").modal('hide');
                    safetyStandards_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=2").load();
                }else {
                    layer.msg("抱歉，您没有此权限");
                }
            });
            // 文件上传失败，显示上传出错。
            uploader2.on( 'uploadError', function( file ) {
                layer.msg("上传失败",{icon:2,time:1500,shade: 0.1});
                $("#file_per_standards").empty();
            });
        }
    }
    var standards1,standards2;
    //新增中的保存-标准
    $("#memberAdd2").submit(function () {
        console.log($("#rulesid2").val());//等于空

        if ($("#rulesid2").val() == "") {
            console.log("新增")
            uploader2.upload();
        } else if($("#rulesid2").val() != ""){
            console.log("编辑bao")
            if(standards1 === standards2){
                console.log(333333333333333)
                console.log($("#rulesid2").val())
                $.ajax({
                    url: "./evalEdit",
                    type: "post",
                    data: {
                        major_key : $("#rulesid2").val(),//
//                        major_key : editId,//
                        eval_name : $("#file_list_aPairOf .info .infoText").val(),//文件名称
                        remark : $("#rulesDesc_standards").val()//备注
                    },
                    datatype: "json",
                    success: function (res) {
                        if(res.code === 1){
                            layer.msg(res.msg);
                            safetyStandards_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=2").load();
                            $("#safetyStandards_modal").modal('hide');
                        }else {
                            layer.msg(res.msg);
                        }
                    }
                })
            }else {
                console.log(44443434343443443)
                uploader2.upload();
            }
        }
    })
    //新增中的返回-标准
    $("#safetyStandards_modal .btn-danger").click(function () {
        standard_uploader = null;
    });
    var standardsId;//点击编辑保存的时候存的id
    //绩效评定-点击编辑-标准
    function standardsEdit(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        standardsId = id;
        $("#rulesDesc_standards").empty();
        $("#rulesid2").val(id)
        $("#safetyStandards_modal h5").text("编辑");
        $("#safetyStandards_modal").modal('show');
        $.ajax({
            url:"./index",
            type: "post",
            data: {major_key:id},
            success: function (res) {
                console.log(res)
                if(res.code ==1) {
                    major_key = $("#rulesid2").val(res.data.major_key);//id
                    eval_name = $("#file_list_standards .info .infoText").val(res.data.eval_name);//文件名称
                    remark = $("#rulesDesc_standards").val(res.data.remark)//备注
                    standards1 = res.data.eval_name
                    standards2 = res.data.eval_name
                    uploader2 = null;
                    upload2();
                    if(res.data.path){
                        $("#file_list_standards").empty().append('<div style="display: inline-block;vertical-align: middle;" id="' + res.data.id + '" class="item">' +
                            '<span class="info"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + res.data.filename + '"/></span>&nbsp' +
                            '<span onclick="fdelatt2(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span>' +
                            '</div>' );
                    }
                    $("#safetyStandards_modal").modal('show');
                }
            }
        })
    }
    //绩效评定-编辑-标准——删除上传的文件
    function fdelatt2(that) {
        var id = $(that).parent("div").attr("id");
        $("#"+id).remove();
    }
    //绩效评定-点击删除-标准
    function standardsDel(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        layer.confirm('确认删除此条记录吗?', {icon: 3, title:'提示'}, function(index){
            $.ajax({
                url: "./evalDel",
                data: {'major_key' : id},
                type: "post",
                dataType: "json",
                success: function (res) {
                    if(res.code == 1){
                        layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});
                        safetyStandards_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=2").load();
                    }else{
                        layer.msg(res.msg,{icon:0,time:1500,shade: 0.1});
                    }
                }
            })
            layer.close(index);
        })
    }

    //安全文明施工年度工作总结
    var safetyCivilization_table = $('#safetyCivilization_table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "__SCRIPT__/safety_evaluation.php?types=3"
        },
        "dom": '<"mybtn2 btn btn-outline btn-primary"><"myl"l><"float_left"f>tip',
        "columnDefs": [
            {
                "searchable": false,
                "orderable": false,
                "targets": [6],
                "render" :  function(data,type,row) {
                    var html = "<input type='button' class='btn btn-info btn-outline btn-xs' style='margin-left: 5px;' onclick='downloadFile(this)' value='下载'/>";
                    html += "<input type='button' class='btn btn-success btn-outline btn-xs' style='margin-left: 5px;' onclick='preview(this)' value='预览'/>" ;
                    html += "<input type='button' class='btn btn-primary btn-outline btn-xs' style='margin-left: 5px;' onclick='civilEdit(this)' value='编辑'/>" ;
                    html += "<input type='button' class='btn btn-danger btn-outline btn-xs' style='margin-left: 5px;' onclick='civilDel(this)' value='删除'/>" ;
                    return html;
                }
            }
        ],
        "language": {
            "lengthMenu": "每页_MENU_ 条记录",
            "zeroRecords": "没有找到记录",
            "info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
            "infoEmpty": "无记录",
            "search": "搜索：",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "paginate": {
                "previous": "上一页",
                "next": "下一页"
            }
        }
    } );
    $("div .mybtn2").html('<div>新增</div>');
    //点击新增出现——安全文明施工年度工作总结modal
    $(".mybtn2").click(function () {
        uploader3=null;
        $("#safetyCivilization_modal input").val("");
        $("#rulesid3").val("")
        $("#rulesDesc_civil").empty();
        $("#safetyCivilization_modal h5").text("新增");
        $("#safetyCivilization_modal").modal('show');
        upload3();
    });

        var uploader3;
        function upload3() {
            if(!uploader3){
                uploader3 = WebUploader.create({
                    auto: false,// 选完文件后，是否自动上传。
                    swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
                    server: "{:url('Upload/uploadEval')}",// 文件接收服务端。
                    chunked: false,
                    fileSizeLimit: 1000 *1024 *1024,
                    fileNumLimit: 1,
    //                formData: {"remark":"","aid":""},
                    duplicate :true,// 重复上传图片，true为可重复false为不可重复
                    pick: {
                        multiple: false,
                        id: "#file_upload_civil",
                        innerHTML: "上传文件"
                    }
                });
                //点击新增出现--上传文件
                uploader3.on( 'fileQueued', function( file ) {
                    aname2 = file.name;
                    $("#file_per_civil").append('<div id="' + file.id + '" class="item">' +
                        '</div>');
                    $("#file_list_civil").append('<div style="display: inline-block;vertical-align: middle;width: 100%;height: 100%;" class="' + file.id + '" class="item">' +
                        '<span class="info" style="padding-left: 10px;"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + file.name + '"/></span>&nbsp' +
                        '<span class="webuploadDelbtn" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;padding-left: 5px;">删除</span>' +
                        '</div>' );
                });
                $("#file_list_civil").on("click", ".webuploadDelbtn", function () {
                    var $ele = $(this);
                    var id = $ele.parent().attr("class");
                    var file = uploader3.getFile(id);
                    uploader3.removeFile(file,true);
                });
                uploader3.on('fileDequeued', function (file) {
                    $(file.id).remove();
                    $('.'+file.id).remove();
                    console.log("remove");
                });
                uploader3.on("uploadStart",function () {
    //                console.log($("#rulesid3").val())
                    uploader3.options.formData.types = 3;//类型
                    uploader3.options.formData.major_key = $("#rulesid3").val();//id
                    uploader3.options.formData.years = $("#civilYear").val();//年度
                    uploader3.options.formData.eval_name = $("#file_list_civil .info .infoText").val();//文件名称
                    uploader3.options.formData.remark = $("#rulesDesc_civil").val()//备注
                });
                uploader3.on('beforeFileQueued', function (file) {
                    if($("#file_list_civil").html()){
                        alert("只能上传一个文件,请先删除文件");
                        return false;
                    }else {
                        return true;
                    }
                });
                // 文件上传过程中创建进度条实时显示。
                uploader3.on('uploadProgress', function (file, percentage) {
                    var $li = $('#' + file.id),
                        $percent = $li.find('.progress .progress-bar');
                    // 避免重复创建
                    if (!$percent.length) {
                        $percent = $('<div class="progress progress-striped active">' +
                            '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                            '</div>' +
                            '</div>').appendTo($li).find('.progress-bar');
                    }
                    $li.find('p.state').text('上传中');
                    $percent.css('width', percentage * 100 + '%');
                });
                // 文件上传成功
                uploader3.on( 'uploadSuccess', function( file,data ) {
                    console.log(file)
                    console.log(data)
                    if(data.code === 1){
                        console.log(8888888)
                        layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
                        $("#file_upload_civil").empty();
                        $("#file_per_civil").empty();
                        $("#file_list_civil").empty();
                        $("#safetyCivilization_modal").modal('hide');
                        safetyCivilization_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=3").load();
                    }else {
                        layer.msg("抱歉，您没有此权限");
                    }
                });
                // 文件上传失败，显示上传出错。
                uploader3.on( 'uploadError', function( file ) {
                    layer.msg("上传失败",{icon:2,time:1500,shade: 0.1});
                    $("#file_per_civil").empty();
                });
            }
        }

        var civil1,civil2;
        //新增中的保存-标准
        $("#memberAdd3").submit(function () {
            console.log($("#rulesid3").val());//等于空

            if ($("#rulesid3").val() == "") {
                console.log("新增")
                uploader3.upload();
            } else if($("#rulesid3").val() != ""){
                console.log("编辑bao")
                if(civil1 === civil2){
                    console.log(333333333333333)
                    console.log($("#rulesid3").val())
                    $.ajax({
                        url: "./evalEdit",
                        type: "post",
                        data: {
                            major_key : $("#rulesid3").val(),//
    //                        major_key : editId,//
                            years : $("#civilYear").val(),//年度
                            eval_name : $("#file_list_civil .info .infoText").val(),//文件名称
                            remark : $("#rulesDesc_civil").val()//备注
                        },
                        datatype: "json",
                        success: function (res) {
                            if(res.code === 1){
                                layer.msg(res.msg);
                                safetyCivilization_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=2").load();
                                $("#safetyCivilization_modal").modal('hide');
                            }else {
                                layer.msg(res.msg);
                            }
                        }
                    })
                }else {
                    console.log(44443434343443443)
                    uploader3.upload();
                }
            }
        })
        //新增中的返回-标准
        $("#safetyCivilization_modal .btn-danger").click(function () {
            standard_uploader = null;
        });
        var civilId;//点击编辑保存的时候存的id
        //绩效评定-点击编辑-标准
        function civilEdit(that) {
            var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
            console.log(id)
            civilId = id;
            $("#rulesDesc_civil").empty();
            $("#rulesid3").val(id)
            $("#safetyCivilization_modal h5").text("编辑");
            $("#safetyCivilization_modal").modal('show');
            $.ajax({
                url:"./index",
                type: "post",
                data: {major_key:id},
                success: function (res) {
                    console.log(res)
                    if(res.code ==1) {
                        major_key = $("#rulesid3").val(res.data.major_key);//id
                        years = $("#civilYear").val(res.data.years);//年度
                        eval_name = $("#file_list_civil .info .infoText").val(res.data.eval_name);//文件名称
                        remark = $("#rulesDesc_civil").val(res.data.remark)//备注
                        civil1 = res.data.eval_name
                        civil2 = res.data.eval_name
                        uploader3 = null;
                        upload3();
                        if(res.data.path){
                            $("#file_list_civil").empty().append('<div style="display: inline-block;vertical-align: middle;" id="' + res.data.id + '" class="item">' +
                                '<span class="info"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + res.data.filename + '"/></span>&nbsp' +
                                '<span onclick="fdelatt3(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span>' +
                                '</div>' );
                        }
                        $("#safetyStandards_modal").modal('show');
                    }
                }
            })
        }
        //绩效评定-编辑-标准——删除上传的文件
        function fdelatt3(that) {
            var id = $(that).parent("div").attr("id");
            $("#"+id).remove();
        }
        //绩效评定-点击删除-标准
        function civilDel(that) {
            var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
            console.log(id)
            layer.confirm('确认删除此条记录吗?', {icon: 3, title:'提示'}, function(index){
                $.ajax({
                    url: "./evalDel",
                    data: {'major_key' : id},
                    type: "post",
                    dataType: "json",
                    success: function (res) {
                        if(res.code == 1){
                            layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});
                            safetyCivilization_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=3").load();
                        }else{
                            layer.msg(res.msg,{icon:0,time:1500,shade: 0.1});
                        }
                    }
                })
                layer.close(index);
            })
        }






    //点击新增里面的 培训材料上传
    var uploaderMaterials;
    //在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题

        uploaderMaterials = WebUploader.create({
            auto: false,
            // swf文件路径
            swf:  '/static/admin/js/webupload/Uploader.swf',

            // 文件接收服务端。
            server: "{:url('Upload/uploadEdu')}",

            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: {
                multiple: false,
                id: "#pickerMaterials",
                innerHTML: "上传"
            },
            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
            resize: false

        });
        var $list = $("#trainerMaterials");
        uploaderMaterials.on( 'fileQueued', function( file ) {
            $list.val(file.name);
            $("#pickerMaterials").append('<span class="pickerCon">等待上传...</span>')
        });

        uploaderMaterials.on( 'uploadSuccess', function( file ) {
            $list.val(file.name);
            $("#pickerMaterials").after('<span class="pickerCon">+file.name+"已上传成功"</span>')
        });

        uploaderMaterials.on( 'uploadError', function( file ) {
            // $list.val('上传出错');
            $("#pickerMaterials").after('<span class="pickerCon">上传出错...</span>')
        });

    //关闭模态框销毁WebUploader
    $('#education_modal').on('hide.bs.modal', function () {
        uploaderMaterials.destroy();
    });
    var uploaderRecords;
    //在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题
    $("#education_modal").on("shown.bs.modal",function(){
        uploaderRecords = WebUploader.create({
            auto: false,
            // swf文件路径
            swf:  '/static/admin/js/webupload/Uploader.swf',

            // 文件接收服务端。
            server: "{:url('Upload/uploadEdu')}",

            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: {
                multiple: false,
                id: "#pickerRecords",
                innerHTML: "上传"
            },
            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
            resize: false

        });
        var $list = $('#trainerRecords');
        uploaderRecords.on( 'fileQueued', function( file ) {
            $list.val(file.name);
            $("#pickerRecords").append('<span class="pickerCon">等待上传...</span>')
        });

        uploaderRecords.on( 'uploadSuccess', function( file ,res ) {
            $list.val(file.name);
            $("#pickerRecords").after('<span class="pickerCon">+file.name+"已上传成功"</span>')
            completeSuccess(res)
        });
        function completeSuccess(data){
            console.log(data);
            if(data.code === 1){
                console.log(groupid+77777777)
                layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
                // aPairOf_table.ajax.url("__SCRIPT__/safety_rules.php?pid=" + groupid).load();
            }else {
                layer.msg('上传数据失败!',{time:1500});
                return false;
            }
        }
        uploaderRecords.on( 'uploadError', function( file ) {
            $list.val('上传出错');
            $("#pickerRecords").after('<span class="pickerCon">上传出错...</span>')
        });
    });
    //关闭模态框销毁WebUploader
    $('#education_modal').on('hide.bs.modal', function () {
        uploaderRecords.destroy();
    });

    var uploader1;
    function upload1() {
        if(!uploader1){
            uploader1 = WebUploader.create({
                auto: false,// 选完文件后，是否自动上传。
                swf: '/static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('Upload/uploadEval')}",// 文件接收服务端。
                chunked: false,
                fileSizeLimit: 1000 *1024 *1024,
                fileNumLimit: 1,
//                formData: {"remark":"","aid":""},
                duplicate :true,// 重复上传图片，true为可重复false为不可重复
                pick: {
                    multiple: false,
                    id: "#file_upload_aPairOf",
                    innerHTML: "上传文件"
                }
            });
            //点击新增出现--上传文件
            uploader1.on( 'fileQueued', function( file ) {
                aname2 = file.name;
                $("#file_per_aPairOf").append('<div id="' + file.id + '" class="item">' +
                    '</div>');
                $("#file_list_aPairOf").append('<div style="display: inline-block;vertical-align: middle;width: 100%;height: 100%;" class="' + file.id + '" class="item">' +
                    '<span class="info" style="padding-left: 10px;"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + file.name + '"/></span>&nbsp' +
                    '<span class="webuploadDelbtn" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;padding-left: 5px;">删除</span>' +
                    '</div>' );
            });
            $("#file_list_aPairOf").on("click", ".webuploadDelbtn", function () {
                var $ele = $(this);
                var id = $ele.parent().attr("class");
                var file = uploader1.getFile(id);
                uploader1.removeFile(file,true);
            });
            uploader1.on('fileDequeued', function (file) {
                $(file.id).remove();
                $('.'+file.id).remove();
                console.log("remove");
            });
            uploader1.on("uploadStart",function () {
                console.log($("#rulesid").val())
                uploader1.options.formData.types = 1;//类型
                uploader1.options.formData.major_key = $("#rulesid1").val();//id
                uploader1.options.formData.years = $("#aPairOfYear").val();//年度
                uploader1.options.formData.eval_name = $("#file_list_aPairOf .info .infoText").val();//文件名称
//                uploader1.options.formData.username = $("#aPairOfPerson").val();//上传人
                uploader1.options.formData.quarter = $("#aPairOfQuarter option:selected").val();//季度
                uploader1.options.formData.remark = $("#rulesDesc").val()//备注
            });
            uploader1.on('beforeFileQueued', function (file) {
                if($("#file_list_aPairOf").html()){
                    alert("只能上传一个文件,请先删除文件");
                    return false;
                }else {
                    return true;
                }
            });
            // 文件上传过程中创建进度条实时显示。
            uploader1.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress .progress-bar');
                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<div class="progress progress-striped active">' +
                        '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                        '</div>' +
                        '</div>').appendTo($li).find('.progress-bar');
                }
                $li.find('p.state').text('上传中');
                $percent.css('width', percentage * 100 + '%');
            });
            // 文件上传成功
            uploader1.on( 'uploadSuccess', function( file,data ) {
                console.log(file)
                console.log(data)
                if(data.code === 1){
                    console.log(77777777)
                    layer.msg(data.msg,{icon:1,time:1500,shade: 0.1});
                    $("#file_upload_aPairOf").empty();
                    $("#file_per_aPairOf").empty();
                    $("#file_list_aPairOf").empty();
                    $("#aPairOf_modal").modal('hide');
                    aPairOf_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=1").load();
                }else {
                    layer.msg("抱歉，您没有此权限");
                }
            });
            // 文件上传失败，显示上传出错。
            uploader1.on( 'uploadError', function( file ) {
                layer.msg("上传失败",{icon:2,time:1500,shade: 0.1});
                $("#file_per_aPairOf").empty();
            });
        }
    }
    var edamid1,edamid2;
    //新增中的保存-一岗双责
    $("#memberAdd1").submit(function () {
        console.log($("#rulesid1").val());//等于空

        if ($("#rulesid1").val() == "") {
            console.log("新增")
            uploader1.upload();
        } else if($("#rulesid1").val() != ""){
            console.log("编辑bao")
            if(edamid1 === edamid2){
                console.log(333333333333333)
                console.log($("#rulesid1").val())
                $.ajax({
                    url: "./evalEdit",
                    type: "post",
                    data: {
                        major_key : $("#rulesid1").val(),//
//                        major_key : editId,//
                        years : $("#aPairOfYear").val(),//年度
                        eval_name : $("#file_list_aPairOf .info .infoText").val(),//文件名称
//                        username : $("#aPairOfPerson").val(),//上传人
                        quarter : $("#aPairOfQuarter option:selected").val(),//季度
                        remark : $("#rulesDesc").val()//备注
                    },
                    datatype: "json",
                    success: function (res) {
                        if(res.code === 1){
                            layer.msg(res.msg);
                            aPairOf_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=1").load();
                            $("#aPairOf_modal").modal('hide');
                        }else {
                            layer.msg(res.msg);
                        }
                    }
                })
            }else {
                console.log(44443434343443443)
                uploader1.upload();
            }
        }
    })
    //新增中的返回-一岗双责
    $("#aPairOf_modal .btn-danger").click(function () {
        standard_uploader = null;
    });

    var editId;//点击编辑保存的时候存的id
    //绩效评定-点击编辑-一岗双责
    function aPairOfEdit(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        editId = id;
        $("#rulesDesc").empty();
        $("#rulesid1").val(id)
        $("#aPairOf_modal h5").text("编辑");
        $("#aPairOf_modal").modal('show');
        $.ajax({
            url:"./index",
            type: "post",
            data: {major_key:id},
            success: function (res) {
                console.log(res)
                if(res.code ==1) {
                    major_key = $("#rulesid1").val(res.data.major_key);//id
                    years = $("#aPairOfYear").val(res.data.years);//年度
                    eval_name = $("#file_list_aPairOf .info .infoText").val(res.data.eval_name);//文件名称
                    username = $("#aPairOfPerson").val(res.data.owner);//上传人
                    quarter = $("#aPairOfQuarter option:selected").val(res.data.quarter);//季度
                    remark = $("#edDesc").val(res.data.remark)//备注
                    edamid1 = res.data.eval_name
                    edamid2 = res.data.eval_name
                    uploader1 = null;
                    upload1();
                    if(res.data.path){
                        $("#file_list_aPairOf").empty().append('<div style="display: inline-block;vertical-align: middle;" id="' + res.data.id + '" class="item">' +
                            '<span class="info"><input id="inputText" class="infoText" style="height: 38px;" type="text" value="' + res.data.filename + '"/></span>&nbsp' +
                            '<span onclick="fdelatt1(this)" style="color: #0d8ddb;text-decoration: underline;cursor: pointer;">删除</span>' +
                            '</div>' );
                    }
                    $("#aPairOf_modal").modal('show');
                }
            }
        })
    }
    //绩效评定-编辑-删除上传的文件
    function fdelatt1(that) {
        var id = $(that).parent("div").attr("id");
        $("#"+id).remove();
    }
    //绩效评定-点击删除-一岗双责
    function aPairOfDel(that) {
            var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
            console.log(id)
            layer.confirm('确认删除此条记录吗?', {icon: 3, title:'提示'}, function(index){
                $.ajax({
                    url: "./evalDel",
                    data: {'major_key' : id},
                    type: "post",
                    dataType: "json",
                    success: function (res) {
                        if(res.code == 1){
                            layer.msg(res.msg,{icon:1,time:1500,shade: 0.1});
                            aPairOf_table.ajax.url("__SCRIPT__/safety_evaluation.php?types=1").load();
                        }else{
                            layer.msg(res.msg,{icon:0,time:1500,shade: 0.1});
                        }
                    }
                })
                layer.close(index);
            })
        }

    //绩效评定-下载方法
    function download(id,url) {
            $.ajax({
                url: url,
                data:{major_key:id},
                success: function (res) {
                    console.log(2121212121212121)
                    if(res.code != 1){
                        layer.msg(res.msg)
                        console.log(res.msg)
                    }else {
                        $("#formDown").empty();
                        var str = "";
                        str += ""
                            + "<iframe name=downloadFrame"+ id +" style='display:none;'></iframe>"
                            + "<form name=download"+ id +" action="+ url+" method='get' target=downloadFrame"+ id + ">"
                            + "<span class='file_name' style='color: #000;'>"+str+"</span>"
                            + "<input class='file_url' style='display: none;' name='id' value="+ id +">"
                            + "<button type='submit' class=btn" + id +"></button>"
                            + "</form>"
                        $("#formDown").append(str);
                        $("#formDown").find(".btn" + id).click();
                    }
                }
            })
        }
    //绩效评定-点击下载-培训材料
    function aPairOfDownload(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        download(id,"./evalDownload");
    }

    //绩效评定-点击下载-标准
    function standardsDownload(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        download(id,"./evalDownload");
    }

    //绩效评定-预览方法
    function showPdf(id,url) {
        $.ajax({
            url: url,
            type: "post",
            data: {major_key:id},
            success: function (res) {
                if(res.code === 1){
                    var path = res.path;
                    window.open("__JS__/web/viewer.html?file=" + path,"_blank");
                }else {
                    layer.msg(res.msg);
                }
            }
        })
    }
    //绩效评定-点击预览-一岗双责
    function aPairOfView(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        showPdf(id,"./evalPreview");
    }
    //绩效评定-点击预览-一岗双责
    function standardsView(that) {
        var id = $(that).parent("td").parent("tr").children("td:nth-of-type(1)").text();
        console.log(id)
        showPdf(id,"./evalPreview");
    }


</script>
</body>
</html>